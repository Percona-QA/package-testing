---
- name: SideEffect
  hosts: all
  become: true
  become_method: sudo
  roles:
    - role: pbm
  tasks:
    - name: remove PBM deb packages
        apt:
          name: "{{ packages }}"
          state: absent
        vars:
          packages:
          - percona-backup-mongodb-coordinator
          - percona-backup-mongodb-agent
          - percona-backup-mongodb-pbmctl
        when: ansible_os_family == "Debian"

    - name: remove PBM rpm packages
        yum:
          name: "{{ packages }}"
          state: absent
        vars:
          packages:
        - percona-backup-mongodb-coordinator
        - percona-backup-mongodb-agent
        - percona-backup-mongodb-pbmctl
        when: ansible_os_family == "RedHat"