# Encapsulates "enabled_db" variable initialization

- name: Set Databases list
  set_fact:
    enabled_db: "{{ db_list|select|list }}"
  vars:
    db_list:
      - "{{ (ansible_distribution != 'Amazon') | ternary('ps-8.4','') }}"
      - "{{ (ansible_distribution == 'Debian') | ternary('ps-8.4','') }}"
      - "{{ (ansible_distribution == 'Ubuntu') | ternary('ps-8.4','') }}"
      - "{{ (ansible_os_family == 'RedHat' and ansible_distribution != 'Amazon') | ternary('ps-8.4','') }}"
      - "{{ (ansible_distribution == 'Debian') | ternary('psmdb-70','') }}"
      - "{{ (ansible_distribution == 'Ubuntu') | ternary('psmdb-80','') }}"
      - "{{ (ansible_os_family == 'RedHat' and ansible_distribution_major_version|int != 10) | ternary('psmdb-80','') }}"
      - "{{ (ansible_distribution == 'Debian') | ternary('pg-17','') }}"
      - "{{ (ansible_distribution == 'Ubuntu') | ternary('pg-17','') }}"
      - "{{ (ansible_os_family == 'RedHat' and ansible_distribution != 'Amazon' and ansible_distribution_major_version|int != 10) | ternary('pg-17','') }}"

- name: Set Percona Server for Debian 11 Bullseye
  set_fact:
    percona_server_version: "ps-8.4"
  when:
    - ansible_distribution == "Debian"
    - ansible_distribution_version.split('.')[0] == "11"

- name: Set Percona Server for Debian 12 Bookworm
  set_fact:
    percona_server_version: "ps-8.4"
  when:
    - ansible_distribution == "Debian"
    - ansible_distribution_version.split('.')[0] == "12"

- name: Debug Distribution name
  debug:
    msg: "{{ ansible_distribution }}"

- name: Debug Distribution version
  debug:
    msg: "{{ ansible_distribution_version }}"